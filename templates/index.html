{% extends "base.html" %}

{% block title %}Discover Singapore - Welcome to Garden City{% endblock %}

{% block content %}
<section class="top-row">
    <div class="card recommendations">
        <div class="card-header">
            <div>
                <h2><i class="fas fa-star"></i> Recommendations of the Day</h2>
                <p>Fresh picks across popular categories, updated every day.</p>
            </div>
            <div class="slider-controls">
                <button class="slider-btn" id="recPrev" aria-label="Previous recommendation"><i class="fas fa-chevron-left"></i></button>
                <button class="slider-btn" id="recNext" aria-label="Next recommendation"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
        <div class="slider" id="recommendationSlider">
            <div class="slider-track" id="recommendationTrack">
                <div class="slider-placeholder">Loading daily picks...</div>
            </div>
            <div class="slider-pagination" id="recommendationDots"></div>
        </div>
    </div>

    <div class="card weather" id="weatherCard">
        <div class="card-header">
            <div>
                <h2><i class="fas fa-cloud"></i> Local Weather Dashboard</h2>
                <p>Nearest forecast, rainfall and PSI from Data.gov.sg</p>
            </div>
        </div>
        <div class="weather-body">
            <div class="weather-summary">
                <h3 id="weatherArea">Singapore (island-wide)</h3>
                <p id="weatherDescription">Latest island-wide outlook from Data.gov.sg.</p>
                <div class="weather-badges">
                    <span class="badge" id="tempBadge"><i class="fas fa-temperature-three-quarters"></i> Temp: --</span>
                    <span class="badge" id="psiBadge"><i class="fas fa-wind"></i> PSI: --</span>
                    <span class="badge" id="rainfallBadge"><i class="fas fa-umbrella"></i> Rainfall: --</span>
                </div>
            </div>
            <ul class="weather-meta">
                <li><i class="fas fa-clock"></i> Updated: <span id="weatherUpdated">--</span></li>
                <li><i class="fas fa-map-pin"></i> Source: <span id="weatherSource">Island-wide</span></li>
            </ul>
            <div class="weather-errors" id="weatherErrors"></div>
        </div>
    </div>
</section>

<section class="map-section">
    <aside class="place-panel" id="placePanel">
        <div class="panel-header">
            <h2><i class="fas fa-info-circle"></i> Place Details</h2>
        </div>
        <div class="panel-body">
            <p class="panel-placeholder">Select a category and tap on a pin to see the full breakdown.</p>
            <div class="place-details" id="placeDetails" hidden>
                <h3 id="placeName">--</h3>
                <div class="place-meta">
                    <span id="placeCategory" class="badge muted">--</span>
                    <span id="placeRating" class="badge"><i class="fas fa-star"></i> --</span>
                    <span id="placeReviews" class="badge muted"><i class="fas fa-users"></i> --</span>
                    <span id="placePrice" class="badge price" hidden><i class="fas fa-dollar-sign"></i></span>
                    <span id="placeDistance" class="badge muted" hidden><i class="fas fa-route"></i></span>
                </div>
                <dl class="place-data">
                    <div>
                        <dt>Status</dt>
                        <dd id="placeStatus"><span class="badge status" data-state="unknown">Unknown</span></dd>
                    </div>
                    <div>
                        <dt>Address</dt>
                        <dd id="placeAddress">--</dd>
                    </div>
                    <div>
                        <dt>Telephone</dt>
                        <dd id="placePhone">--</dd>
                    </div>
                    <div>
                        <dt>Website</dt>
                        <dd id="placeWebsite"><a href="#" target="_blank" rel="noopener" id="placeWebsiteLink">--</a></dd>
                    </div>
                    <div>
                        <dt>Opening Hours</dt>
                        <dd>
                            <ul class="opening-hours" id="placeHours"></ul>
                        </dd>
                    </div>
                </dl>
                <div class="save-comment">
                    <button id="savePlace" class="btn star-btn" aria-pressed="false" title="Save this place">
                        <i class="far fa-star"></i> Save
                    </button>
                    <div class="comment-box">
                        <textarea id="commentText" rows="3" placeholder="Share your thoughts..."></textarea>
                        <button id="postComment" class="btn ghost"><i class="fas fa-paper-plane"></i> Post</button>
                    </div>
                    <div class="comments-list" id="commentsList"></div>
                </div>
            </div>
        </div>
    </aside>

    <div class="map-wrapper">
        <div class="map-toolbar">
            <button id="locateMe" class="btn ghost"><i class="fas fa-location-arrow"></i> Re-centre on Me</button>
            <label for="categorySelect" class="sr-only">Select a category</label>
            <select id="categorySelect" class="category-select"></select>
            <span class="toolbar-text" id="placeCount">Explore up to 10 places per category. Share location to personalise results.</span>
            <button id="refreshData" class="btn ghost"><i class="fas fa-sync"></i> Refresh Data</button>
        </div>
        <div id="map" class="map"></div>
        <div class="map-legend">
            <span><i class="fas fa-location-crosshairs"></i> You</span>
            <span><i class="fas fa-map-marker-alt"></i> Selected Places</span>
        </div>
    </div>
</section>

<section id="reviews" class="card reviews">
    <div class="card-header">
        <div>
            <h2><i class="fas fa-comments"></i> Ratings & Comments</h2>
            <p>Community notes saved locally on your device.</p>
        </div>
    </div>
    <div class="reviews-body">
        <div id="reviewsList" class="reviews-list"></div>
    </div>
    </section>

<section id="saved" class="card saved">
    <div class="card-header">
        <div>
            <h2><i class="fas fa-bookmark"></i> Saved Places</h2>
            <p>Your bookmarked places (stored locally).</p>
        </div>
    </div>
    <div id="savedList" class="saved-list"></div>
</section>

<section class="card data-viz">
    <div class="card-header">
        <div>
            <h2><i class="fas fa-chart-bar"></i> Data Visualisation</h2>
            <p>Explore ratings distribution by category.</p>
        </div>
    </div>
    <div class="viz-body">
        <canvas id="ratingsChart" height="120"></canvas>
    </div>
</section>
{% endblock %}
